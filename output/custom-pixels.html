<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

  <meta name="google-site-verification" content="yQh84bCkno9EjLcuqA5P2dztLWkwgr5WVqTJa9Za_6g">

  <title>Music Video</title>


  <meta property="og:title" content="Music Video" />
  <meta property="og:type" content="article" />
  <meta property="og:image" content="/images/markus-spiske-78531-unsplash.jpg" />
  <meta property="og:url" content="https://chrisdinant.github.io/custom-pixels.html" />
  <meta property="og:description" content="I made a script that replaces pixels in movies with 20x20 size jpgs." />
  <meta property="og:locale" content="" />
  <meta property="og:site_name" content="Transferred Learnings" />
  <meta property="article:published_time" content="2018-10-28" />
  <meta property="article:section" content="not-data-science" />
  <meta property="article:tag" content="python" />
  <meta property="article:tag" content="youtube" />
  <meta property="article:tag" content="video" />
  <meta property="article:tag" content="ffmpeg" />
  <meta property="article:tag" content="pipe" />


  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="referrer" content="origin" />
  <meta name="generator" content="Pelican" />
  <link href="./" rel="canonical" />

  <!-- Feed -->

  <link href="./theme/css/style.css" type="text/css" rel="stylesheet" />

  <!-- Code highlight color scheme -->
      <link href="./theme/css/code_blocks/github.css" rel="stylesheet">


  <!-- Custom fonts -->
  <link href='https://fonts.googleapis.com/css?family=Montserrat:400,300' rel='stylesheet' type='text/css' />
  <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet" type="text/css" />

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  <![endif]-->


  <link href="./custom-pixels.html" rel="canonical" />

    <meta name="description" content="Custom pixel replacement for video with FFMPEG">

    <meta name="author" content="Chris Dinant">

    <meta name="tags" content="python">
    <meta name="tags" content="youtube">
    <meta name="tags" content="video">
    <meta name="tags" content="ffmpeg">
    <meta name="tags" content="pipe">




<!-- Open Graph -->
<meta property="og:site_name" content="Transferred Learnings"/>
<meta property="og:title" content="Music Video"/>
<meta property="og:description" content="Custom pixel replacement for video with FFMPEG"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="./custom-pixels.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2018-10-28 00:00:00+02:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="./author/chris-dinant.html">
<meta property="article:section" content="not-data-science"/>
<meta property="article:tag" content="python"/>
<meta property="article:tag" content="youtube"/>
<meta property="article:tag" content="video"/>
<meta property="article:tag" content="ffmpeg"/>
<meta property="article:tag" content="pipe"/>
<meta property="og:image" content=".//images/markus-spiske-78531-unsplash.jpg">

<!-- Twitter Card -->

<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "name": "Music Video",
  "headline": "Music Video",
  "datePublished": "2018-10-28 00:00:00+02:00",
  "dateModified": "",
  "author": {
    "@type": "Person",
    "name": "Chris Dinant",
    "url": "./author/chris-dinant.html"
  },
  "image": ".//images/markus-spiske-78531-unsplash.jpg",
  "url": "./custom-pixels.html",
  "description": "Custom pixel replacement for video with FFMPEG"
}
</script>
</head>
<!-- TODO : Body class -->
<body class="home-template">

<nav id="menu">
  <a class="close-button">Close</a>
  <div class="nav-wrapper">
    <p class="nav-label">Menu</p>
    <ul>

              <li role="presentation"><a href="./pages/about-me.html">Whose blog is this?</a></li>
              <li role="presentation"><a href="./pages/purpose.html">The purpose of this blog</a></li>
      
                  <li role="presentation"><a href="./category/data-science.html">data-science</a></li>
                  <li class="nav-not-data-science active" role="presentation"><a href="./category/not-data-science.html">not-data-science</a></li>

    </ul>
  </div>
</nav>
    <!-- Progressbar -->
    <div class="progress-container">
        <span class="progress-bar"></span>
    </div>

    <!-- Page Header -->
    <!-- Set your background image for this header on the line below. -->
    <header id="post-header" class="has-cover">
      <div class="inner">
        <nav id="navigation">
            <span class="blog-logo">
              <a href="./"><img src="/extra/delta9.png" alt="Blog Logo" /></a>
            </span>
          <span id="menu-button" class="nav-button">
            <a class="menu-button"><i class="ic ic-menu"></i> Menu</a>
          </span>
        </nav>
        <h1 class="post-title">Music Video</h1>
        <!-- TODO : Proper class for headline -->
          <span class="blog-description">Custom pixel replacement for video with FFMPEG</span>
        <span class="post-meta">
                <a href="./author/chris-dinant.html">chris dinant</a>
            | <time datetime="Sun 28 October 2018">Sun 28 October 2018</time>
        </span>
        <!-- TODO : Modified check -->
            <div class="post-cover cover" style="background-image: url('.//images/markus-spiske-78531-unsplash.jpg')">
      </div>
    </header>

  <section id="wrapper">
    <a class="hidden-close"></a>

    <!-- Post content -->
    <main class="content" role="main">
        <article class="post">
        <div class="inner">
            <section class="post-content">
                <p>Here's my children dancing around in the yard to my song.<br/>
Have a watch:</p>
<iframe allow="autoplay; encrypted-media" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/7qvhSWrXff4" width="560"></iframe>
<p>This video was created by a custom python script that replaces pixels of low resolution images with jpegs of 20x20 pixels. Four different jpegs replace pixels of four grey intensity ranges. The python script uses ffmpeg to pipe individual frames of a video to the pixel replacement function and then pipe the new images into a new video file. In this video I use two jpeg sets, one with dots and lines and one with colored circles that look like hama beads (<a href="http://www.hama.dk/welcome-to-a-color">http://www.hama.dk/welcome-to-a-color</a>...).  </p>
<p>Here's the import piece of code that extracts frames, replaces pixels and saves the frames back into a video:</p>
<div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">extract_frames</span><span class="p">(</span><span class="n">rate</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span> <span class="n">outf</span> <span class="o">=</span> <span class="s1">'perl_light2.avi'</span><span class="p">):</span>    
    <span class="n">command</span> <span class="o">=</span> <span class="p">[</span><span class="n">FFMPEG_BIN</span><span class="p">,</span>
                <span class="s1">'-i'</span><span class="p">,</span> <span class="s1">'IMG_1981.MOV'</span><span class="p">,</span>
                <span class="s1">'-f'</span><span class="p">,</span> <span class="s1">'image2pipe'</span><span class="p">,</span>
                <span class="s1">'-r'</span><span class="p">,</span> <span class="s1">'</span><span class="si">%d</span><span class="s1">'</span> <span class="o">%</span> <span class="n">rate</span><span class="p">,</span>
                <span class="s1">'-pix_fmt'</span><span class="p">,</span> <span class="s1">'rgb24'</span><span class="p">,</span>
                <span class="s1">'-vcodec'</span><span class="p">,</span> <span class="s1">'rawvideo'</span><span class="p">,</span> <span class="s1">'-'</span><span class="p">]</span>
    <span class="n">pipe</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">stdout</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span> <span class="n">bufsize</span><span class="o">=</span><span class="mi">10</span><span class="o">**</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">cmdstring</span> <span class="o">=</span> <span class="p">[</span><span class="n">FFMPEG_BIN</span><span class="p">,</span>
                 <span class="s1">'-y'</span><span class="p">,</span>
                 <span class="s1">'-r'</span><span class="p">,</span> <span class="s1">'</span><span class="si">%d</span><span class="s1">'</span> <span class="o">%</span> <span class="n">rate</span><span class="p">,</span>
                 <span class="s1">'-f'</span><span class="p">,</span><span class="s1">'image2pipe'</span><span class="p">,</span>
                 <span class="s1">'-vcodec'</span><span class="p">,</span> <span class="s1">'mjpeg'</span><span class="p">,</span>
                 <span class="s1">'-i'</span><span class="p">,</span> <span class="s1">'pipe:'</span><span class="p">,</span>
                 <span class="s1">'-vcodec'</span><span class="p">,</span> <span class="n">codec</span><span class="p">,</span>             
                 <span class="n">outf</span><span class="p">]</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">Popen</span><span class="p">(</span><span class="n">cmdstring</span><span class="p">,</span> <span class="n">stdin</span><span class="o">=</span><span class="n">sp</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>  

    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">55</span><span class="p">)):</span>         
        <span class="n">raw_image</span> <span class="o">=</span> <span class="n">pipe</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1280</span><span class="o">*</span><span class="mi">720</span><span class="o">*</span><span class="mi">3</span><span class="p">)</span>
        <span class="c1"># transform the byte read into a numpy array</span>
        <span class="n">image</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">frombuffer</span><span class="p">(</span><span class="n">raw_image</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">'uint8'</span><span class="p">)</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">image</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="mi">1280</span><span class="p">,</span><span class="mi">720</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>    
        <span class="c1"># throw away the data in the pipe's buffer.</span>
        <span class="n">pipe</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
        <span class="n">image</span> <span class="o">=</span> <span class="n">rgb2gray</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>        
        <span class="n">ori</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="c1">#crop = ori.crop((260,530,460,730))</span>
        <span class="n">small</span> <span class="o">=</span> <span class="n">ori</span><span class="o">.</span><span class="n">resize</span><span class="p">((</span><span class="mi">72</span><span class="p">,</span><span class="mi">128</span><span class="p">))</span>
        <span class="c1"># morph the first couple of frames from noise to the first image</span>
        <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>            
            <span class="n">first_frame</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span><span class="mi">72</span><span class="p">)</span><span class="o">*</span><span class="mi">255</span>
            <span class="n">inc</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">small</span><span class="p">)</span> <span class="o">-</span> <span class="n">first_frame</span><span class="p">)</span><span class="o">/</span><span class="mi">30</span>        
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">):</span>
                <span class="n">first_frame</span> <span class="o">=</span> <span class="n">first_frame</span> <span class="o">+</span> <span class="n">inc</span>
                <span class="n">frame</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">fromarray</span><span class="p">(</span><span class="n">first_frame</span><span class="p">)</span>
                <span class="n">frame</span> <span class="o">=</span> <span class="n">perlize</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">board</span><span class="p">)</span>
                <span class="n">p</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">frame</span><span class="o">.</span><span class="n">tobytes</span><span class="p">(</span><span class="s1">'jpeg'</span><span class="p">,</span> <span class="s1">'RGB'</span><span class="p">))</span>              
        <span class="n">frame</span> <span class="o">=</span> <span class="n">perlize</span><span class="p">(</span><span class="n">small</span><span class="p">,</span> <span class="n">board</span><span class="p">)</span>        
        <span class="n">frame</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">tobytes</span><span class="p">(</span><span class="s1">'jpeg'</span><span class="p">,</span><span class="s1">'RGB'</span><span class="p">)</span>
        <span class="n">p</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">frame</span><span class="p">)</span>

    <span class="n">p</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
<p>Δ9</p>
            </section>

            <section class="post-info">
                <div class="post-share">
                    <a class="twitter" href="https://twitter.com/share?text=Music Video&amp;url=./custom-pixels.html" onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
                    <i class="ic ic-twitter"></i><span class="hidden">Twitter</span>
                    </a>
                    <a class="facebook" href="https://www.facebook.com/sharer/sharer.php?u=./custom-pixels.html" onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
                    <i class="ic ic-facebook"></i><span class="hidden">Facebook</span>
                    </a>
                    <a class="googleplus" href="https://plus.google.com/share?url=./custom-pixels.html" onclick="window.open(this.href, 'google-plus-share', 'width=490,height=530');return false;">
                    <i class="ic ic-googleplus"></i><span class="hidden">Google+</span>
                    </a>
                    <div class="clear"></div>
                </div>

                <aside class="post-tags">
<a href="./tag/python.html">python</a><a href="./tag/youtube.html">youtube</a><a href="./tag/video.html">video</a><a href="./tag/ffmpeg.html">ffmpeg</a><a href="./tag/pipe.html">pipe</a>                </aside>

                <div class="clear"></div>

                <aside class="post-author">


                        <figure class="post-author-avatar">
                            <img src="./extra/delta9.png" alt="chris dinant" />
                        </figure>
                    <div class="post-author-bio">
                        <h4 class="post-author-name"><a href="./author/chris-dinant.html">chris dinant</a></h4>
                            <p class="post-author-about">Only if you can explain something in simple terms do you really understand it. That's what I'm trying to do with this blog.</p>
                            <span class="post-author-location"><i class="ic ic-location"></i> Copenhagen</span>
                        <!-- Social linkes in alphabet order. -->
                            <span class="post-author-github"><a target="_blank" href="https://github.com/chrisdinant"><i class="ic ic-link"></i> GitHub</a></span>
                            <span class="post-author-linkedin"><a target="_blank" href="https://www.linkedin.com/in/chris-dinant"><i class="ic ic-link"></i> LinkedIn</a></span>
                            <span class="post-author-twitter"><a target="_blank" href="https://twitter.com/chrisdinant"><i class="ic ic-twitter"></i> Twitter</a></span>
                    </div>
                    <div class="clear"></div>
                </aside>

                </section>

                <script type="text/javascript">
                    var disqus = 'chrisdinant';
                    var disqus_shortname = 'chrisdinant';
                    var disqus_identifier = '/custom-pixels.html';
                    var disqus_url = './custom-pixels.html';
                </script>
                <noscript>Please enable JavaScript to view the comments.</noscript>
                <section class="post-comments">
                        <a id="show-disqus" class="post-comments-activate" data-disqus-identifier="/custom-pixels.html" >Show Comments</a>
                    <div id="disqus_thread"></div>
                </section>

                <aside class="post-nav">
                    <a class="post-nav-prev" href="./naive-Bayes.html">
                        <section class="post-nav-teaser">
                            <i class="ic ic-arrow-right"></i>
                                <h2 class="post-nav-title">What's so naive about naive Bayes?</h2>
                            <p class="post-nav-excerpt">Assuming feature independence tends to help classification accuracy</p>
                        </section>
                    </a>
                    <div class="clear"></div>
                </aside>

            </div>
        </article>
    </main>
      <!-- TODO : Body class -->
    <div id="body-class" style="display: none;" class=""></div>

    <footer id="footer">
      <div class="inner">
        <section class="credits">


          <span class="credits-theme">Theme <a href="https://github.com/arulrajnet/attila" rel="nofollow">Attila</a></span>
          <span class="credits-software">Published with <a href="https://github.com/getpelican/pelican" rel="nofollow">Pelican</a></span>
        </section>
      </div>
    </footer>
  </section>

  <script type="text/javascript" src="./theme/js/script.js"></script>

<script type="text/javascript">
    var disqus_shortname = 'chrisdinant';
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</body>
</html>